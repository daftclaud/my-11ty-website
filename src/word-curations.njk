---
layout: base.njk
locale: en
permalink: /word-curations/
---

{% set baseUrl = '' %}

<style>
  .hero-quote {
    background: #ffffff;
    border-left: 5px solid #ff00ff;
    padding: 30px;
    margin: 0 0 40px 0;
    border-radius: 5px;
    box-shadow: 0 2px 8px rgba(255, 0, 255, 0.1);
  }

  .hero-quote blockquote {
    margin: 0;
    border: none;
    padding: 0;
  }

  .quote-text {
    font-size: 1.3em;
    font-weight: 500;
    color: #333;
    text-align: left;
    line-height: 1.7;
    margin: 0 0 15px 0;
    font-style: italic;
  }

  .quote-author {
    text-align: left;
    color: #ff00ff;
    font-size: 0.95em;
    font-weight: bold;
    font-style: normal;
  }

  .intro-text {
    font-size: 1.05em;
    line-height: 1.8;
    margin: 30px 0;
  }

  .intro-text p {
    margin-bottom: 1.2em;
  }

  .view-toggle-container {
    margin: 40px 0 30px 0;
    text-align: center;
    /* Sticky on mobile */
    position: sticky;
    top: 60px;
    z-index: 50;
    background: linear-gradient(180deg, rgba(255, 255, 224, 0.95) 0%, rgba(255, 255, 224, 0.9) 100%);
    padding: 15px 0;
    border-bottom: 2px solid #ff00ff;
  }

  [data-theme="dark"] .view-toggle-container {
    background: linear-gradient(180deg, rgba(26, 26, 46, 0.95) 0%, rgba(26, 26, 46, 0.9) 100%);
  }

  @media (min-width: 600px) {
    .view-toggle-container {
      position: static;
      background: transparent;
      border-bottom: none;
      margin: 40px 0 30px 0;
    }
  }

  .view-toggle {
    display: inline-flex;
    gap: 0;
    background: #fff;
    border: 3px solid #ff00ff;
    border-radius: 8px;
    overflow: hidden;
  }

  .view-toggle-btn {
    padding: 12px 30px;
    background: #fff;
    border: none;
    border-right: 2px solid #ff00ff;
    cursor: pointer;
    font-family: var(--ff-body);
    font-weight: bold;
    font-size: 1em;
    color: #ff00ff;
    transition: all 0.2s;
  }

  .view-toggle-btn:last-child {
    border-right: none;
  }

  .view-toggle-btn:hover {
    background: #fff9e6;
  }

  .view-toggle-btn.active {
    background: #ff00ff;
    color: #fff;
  }

  .content-view {
    margin-top: 30px;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 30px 0;
  }

  .stat-card {
    background: #fff;
    border: 3px solid #ff00ff;
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    box-shadow: 4px 4px 0 #000;
  }

  .stat-number {
    font-size: 3em;
    font-weight: bold;
    color: #ff4500;
    text-shadow: 2px 2px #000;
  }

  .stat-label {
    margin-top: 10px;
    font-size: 1em;
    color: #333;
  }

  .timeline-view-toggle {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }

  .toggle-btn {
    padding: 10px 20px;
    background: #fff;
    border: 2px solid #ff00ff;
    border-radius: 5px;
    cursor: pointer;
    font-family: var(--ff-body);
    font-weight: bold;
    color: #ff00ff;
    transition: all 0.2s;
  }

  .toggle-btn:hover {
    transform: translateY(-2px);
    box-shadow: 2px 2px 0 rgba(255, 0, 255, 0.3);
  }

  .toggle-btn.active {
    background: #ff00ff;
    color: #fff;
  }

  /* Overview Section Collapsible */
  .overview-section {
    background: #fff;
    border: 2px solid #ff00ff;
    border-radius: 8px;
    margin-bottom: 20px;
    overflow: hidden;
  }

  .overview-section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background: linear-gradient(135deg, #fff9e6 0%, #fff 100%);
    cursor: pointer;
    user-select: none;
    border-bottom: 2px solid #ff00ff;
    transition: all 0.2s ease;
  }

  .overview-section-header:hover {
    background: linear-gradient(135deg, #ffedcc 0%, #fff9e6 100%);
  }

  .overview-section-header h3 {
    margin: 0;
    font-size: 1.2em;
    color: #ff4500;
    text-shadow: 1px 1px #000;
  }

  .overview-toggle-icon {
    font-size: 1.2em;
    transition: transform 0.3s ease;
    display: inline-block;
  }

  .overview-section-content {
    padding: 20px;
    max-height: none;
    overflow: visible;
    transition: padding 0.3s ease;
  }

  .overview-section.collapsed .overview-section-content {
    max-height: 0;
    padding: 0 20px;
    overflow: hidden;
  }

  .overview-section.collapsed .overview-toggle-icon {
    transform: rotate(-90deg);
  }

  .overview-section.expanded .overview-toggle-icon {
    transform: rotate(0deg);
  }

  /* Mobile overview optimization */
  @media (max-width: 600px) {
    .overview-section {
      margin-bottom: 12px;
      border-radius: 6px;
      border-width: 1.5px;
    }

    .overview-section-header {
      padding: 12px 15px;
      border-bottom-width: 1.5px;
    }

    .overview-section-header h3 {
      font-size: 1em;
    }

    .overview-toggle-icon {
      font-size: 1em;
    }

    .overview-section-content {
      padding: 12px;
    }

    .overview-section.collapsed .overview-section-content {
      padding: 0 12px;
    }
  }

  /* Dark mode adjustments */
  [data-theme="dark"] .overview-section {
    background: #16213e;
    border-color: #ff6b35;
  }

  [data-theme="dark"] .overview-section-header {
    background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
    border-bottom-color: #ff6b35;
  }

  [data-theme="dark"] .overview-section-header:hover {
    background: linear-gradient(135deg, #163a5a 0%, #1d4a70 100%);
  }

  .timeline-chart,
  .monthly-activity,
  .alphabet-chart {
    margin: 30px 0;
  }

  .chart-container {
    background: #fff;
    border: 3px solid #ff00ff;
    padding: 20px;
    border-radius: 10px;
  }

  .timeline-calendar {
    padding: 20px;
    background: linear-gradient(135deg, #fff9e6 0%, #fff 50%, #e6f7ff 100%);
  }

  /* Mobile container optimization */
  @media (max-width: 600px) {
    .chart-container {
      border-width: 2px;
      padding: 12px;
      border-radius: 6px;
    }

    .timeline-calendar {
      padding: 12px;
      border-radius: 6px;
    }
  }

  .calendar-grid {
    display: flex;
    flex-direction: column;
    gap: 40px;
    margin-bottom: 40px;
  }

  .year-section {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 10px;
    padding: 20px;
    border-left: 5px solid #ff00ff;
  }

  .year-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #ff00ff;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  /* Mobile timeline optimization */
  @media (max-width: 600px) {
    .calendar-grid {
      gap: 15px;
      margin-bottom: 15px;
    }

    .year-section {
      padding: 12px;
      border-radius: 6px;
    }

    .year-header {
      margin-bottom: 12px;
      padding-bottom: 10px;
      gap: 8px;
    }

    .year-header h3 {
      font-size: 1.3em;
    }

    .year-total {
      font-size: 1em;
    }

    .months-grid {
      gap: 6px;
    }

    .mini-calendar {
      padding: 8px;
    }

    .mini-month-label {
      font-size: 0.75em;
      margin-bottom: 5px;
    }

    .mini-days {
      gap: 2px;
    }
  }

  .year-header:hover {
    opacity: 0.85;
  }

  .year-header h3 {
    margin: 0;
    font-size: 1.8em;
    color: #ff4500;
    text-shadow: 1px 1px #000;
  }

  .year-total {
    font-weight: bold;
    font-size: 1.3em;
    color: #ff00ff;
    text-shadow: 1px 1px #000;
  }

  .year-toggle-icon {
    display: none;
    font-size: 1.2em;
    margin-left: 10px;
    transition: transform 0.3s ease;
  }

  .months-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 10px;
    transition: all 0.3s ease;
  }

  /* Mobile collapsible years */
  @media (max-width: 600px) {
    .year-header {
      cursor: pointer;
    }

    .year-toggle-icon {
      display: inline-block;
    }

    .year-section.collapsed .months-grid {
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      margin: 0;
    }

    .year-section.expanded .months-grid {
      max-height: 2000px;
      opacity: 1;
      margin: 20px 0 0 0;
    }

    .year-section.collapsed .year-toggle-icon {
      transform: rotate(0deg);
    }

    .year-section.expanded .year-toggle-icon {
      transform: rotate(180deg);
    }
  }

  .mini-calendar {
    background: #fff;
    border: 2px solid #00ffff;
    border-radius: 8px;
    padding: 10px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  }

  .mini-month-label {
    font-weight: bold;
    color: #ff4500;
    text-align: center;
    font-size: 0.85em;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .mini-days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 3px;
  }

  .mini-day {
    aspect-ratio: 1;
    background-color: #e8e8e8;
    border-radius: 3px;
    transition: all 0.3s ease;
    cursor: pointer;
    border: 1px solid #ddd;
  }

  .mini-day:hover {
    transform: scale(1.1);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .timeline-legend {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 10px;
    padding: 20px;
    border: 2px solid #ff00ff;
    margin-bottom: 30px;
  }

  .legend-title {
    font-weight: bold;
    color: #ff4500;
    margin-bottom: 15px;
    font-size: 1.1em;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .legend-scale {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .legend-box {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    border: 1px solid #999;
  }

  .legend-item span {
    color: #666;
    font-size: 0.9em;
  }

  .timeline-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 2px solid #ff00ff;
  }

  .timeline-stat-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px;
    background: rgba(255, 0, 255, 0.05);
    border-radius: 8px;
    border-left: 4px solid #ff00ff;
  }

  .timeline-stat-item .stat-label {
    font-size: 0.9em;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 600;
    margin-bottom: 8px;
  }

  .timeline-stat-item .stat-value {
    font-size: 1.5em;
    font-weight: bold;
    color: #ff4500;
    text-shadow: 1px 1px #000;
  }

  .activity-table {
    width: 100%;
    background: #fff;
    border: 3px solid #ff00ff;
    border-collapse: collapse;
    border-radius: 10px;
    overflow: hidden;
  }

  .activity-table th {
    background: #00ffff;
    padding: 15px;
    text-align: left;
    border-bottom: 3px solid #ff00ff;
  }

  .activity-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #ddd;
  }

  .activity-table tbody tr:hover {
    background: #fffacd;
  }

  .repeated-words {
    margin: 30px 0;
  }

  .repeated-table {
    width: 100%;
    background: #fff;
    border: 3px solid #ff00ff;
    border-collapse: collapse;
    border-radius: 10px;
    overflow: hidden;
  }

  .repeated-table th {
    background: #00ffff;
    padding: 15px;
    text-align: left;
    border-bottom: 3px solid #ff00ff;
  }

  .repeated-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #ddd;
  }

  .repeated-table .word-column {
    font-weight: bold;
    color: #ff4500;
    min-width: 120px;
  }

  .repeated-table .count-column {
    text-align: center;
    width: 100px;
    background: #fff9e6;
    font-weight: bold;
  }

  .repeated-table .definition-column {
    font-size: 0.95em;
    color: #555;
  }

  .repeated-table tbody tr:hover {
    background: #fffacd;
  }

  .alphabet-chart {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    background: #fff;
    border: 3px solid #ff00ff;
    padding: 20px;
    border-radius: 10px;
    height: 250px;
    overflow-x: auto;
  }

  .letter-bar {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
    min-width: 30px;
  }

  .letter-label {
    margin-top: 10px;
    font-weight: bold;
    color: #ff4500;
    font-size: 1.1em;
  }

  .letter-bar-wrapper {
    width: 100%;
    height: 150px;
    display: flex;
    align-items: flex-end;
    justify-content: center;
  }

  .letter-bar-fill {
    width: 80%;
    background: linear-gradient(180deg, #ff00ff, #00ffff);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;
    padding: 5px 0;
    border-radius: 5px 5px 0 0;
    transition: height 0.3s ease;
  }

  .letter-count {
    font-size: 0.7em;
    font-weight: bold;
    color: #000;
  }

  .monthly-activity {
    margin: 30px 0;
  }

  .all-sources-container {
    background: #fff;
    border: 3px solid #00ffff;
    border-radius: 10px;
    padding: 20px;
    margin: 30px 0;
  }

  .sources-controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 2px solid #00ffff;
    align-items: end;
  }

  .control-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
  }

  .control-group label {
    font-weight: bold;
    color: #ff00ff;
    font-size: 0.9em;
  }

  .source-search,
  .source-sort,
  .source-filter {
    padding: 8px 12px;
    border: 2px solid #00ffff;
    border-radius: 5px;
    font-family: var(--ff-body);
    font-size: 1em;
    transition: border-color 0.2s;
  }

  .source-search:focus,
  .source-sort:focus,
  .source-filter:focus {
    outline: none;
    border-color: #ff00ff;
    box-shadow: 0 0 0 3px rgba(255, 0, 255, 0.1);
  }

  .control-info {
    display: flex;
    align-items: flex-end;
    padding-bottom: 8px;
    color: #666;
    font-weight: bold;
  }

  #sourceCount {
    color: #ff00ff;
  }

  .all-sources-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 12px;
    max-height: 500px;
    overflow-y: auto;
    padding: 10px;
  }

  .source-item {
    background: #f9f9f9;
    border: 2px solid #00ffff;
    padding: 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .source-item:hover {
    background: #ffffe0;
    border-color: #ff00ff;
    transform: translateY(-2px);
    box-shadow: 2px 2px 0 rgba(255, 0, 128, 0.3);
  }

  .source-item-name {
    font-weight: bold;
    color: #ff4500;
    margin-bottom: 5px;
    word-break: break-word;
  }

  .source-item-count {
    color: #00ffff;
    font-size: 0.9em;
    font-weight: bold;
  }

  .sources-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
    margin: 30px 0;
  }

  .source-card {
    background: #fff;
    border: 2px solid #ff00ff;
    padding: 15px;
    border-radius: 8px;
    transition: transform 0.2s;
    cursor: pointer;
  }

  .source-card:hover {
    transform: translateY(-5px);
    box-shadow: 4px 4px 0 #000;
  }

  .source-card.active {
    background: #ff00ff;
    color: #fff;
  }

  .source-card.active .source-name {
    color: #fff;
  }

  .source-card.active .source-count {
    color: #fffacd;
  }

  .source-name {
    font-weight: bold;
    color: #ff4500;
    margin-bottom: 5px;
  }

  .source-count {
    color: #666;
  }

  .source-words-section {
    background: #fff;
    border: 3px solid #ff00ff;
    border-radius: 10px;
    padding: 20px;
    margin: 30px 0;
    max-height: 600px;
    overflow-y: auto;
  }

  .source-words-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #ff00ff;
  }

  .source-words-header h3 {
    margin: 0;
    color: #ff4500;
  }

  .close-btn {
    background: #ff00ff;
    color: #fff;
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 18px;
    font-weight: bold;
    transition: background 0.2s;
  }

  .close-btn:hover {
    background: #ff4500;
  }

  .source-words-list {
    display: grid;
    gap: 15px;
  }

  .word-item {
    background: #f9f9f9;
    border-left: 4px solid #ff4500;
    padding: 15px;
    border-radius: 5px;
  }

  .word-item-title {
    font-weight: bold;
    font-size: 1.1em;
    color: #ff4500;
    margin-bottom: 5px;
  }

  .word-item-definition {
    color: #333;
    margin: 8px 0;
    line-height: 1.5;
  }

  .word-item-date {
    font-size: 0.9em;
    color: #666;
    font-style: italic;
  }

  .milestones {
    margin: 30px 0;
  }

  .milestone-list {
    list-style: none;
    padding: 0;
    background: #fff;
    border: 3px solid #ff00ff;
    border-radius: 10px;
    padding: 20px;
  }

  .milestone-item {
    display: flex;
    align-items: flex-start;
    padding: 15px;
    margin: 10px 0;
    background: #fffacd;
    border-radius: 8px;
  }

  .milestone-icon {
    font-size: 2em;
    margin-right: 15px;
  }

  .milestone-text {
    flex: 1;
  }

  .milestone-text strong {
    color: #ff4500;
  }

  .random-word-section {
    background: #fff;
    border: 3px solid #ff00ff;
    border-radius: 10px;
    padding: 30px;
    text-align: center;
    margin: 30px 0;
  }

  .word-spotlight {
    background: linear-gradient(135deg, #fffacd, #00ffff);
    padding: 30px;
    border-radius: 10px;
    margin-bottom: 20px;
  }

  .spotlight-word {
    font-size: 2.5em;
    color: #ff4500;
    text-shadow: 2px 2px #000;
    margin-bottom: 15px;
  }

  .spotlight-definition {
    font-size: 1.2em;
    margin: 15px 0;
    line-height: 1.6;
  }

  .spotlight-source,
  .spotlight-date {
    color: #666;
    font-style: italic;
    margin: 10px 0;
  }

  .refresh-note {
    color: #666;
    font-size: 0.9em;
  }

  .year-container .calendar-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 30px;
    margin: 30px 0;
    overflow-x: auto;
    padding: 10px 0;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .year-container .calendar-grid::-webkit-scrollbar {
    display: none;
  }

  .year-container {
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .year-container::-webkit-scrollbar {
    display: none;
  }

  .month {
    border-spacing: 0;
    display: inline-block;
    height: 260px;
    margin: 0;
    padding: 0 12px;
    vertical-align: bottom;
    width: 220px;
    background: #fff;
    border: 2px solid #ff00ff;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    flex-shrink: 0;
    overflow: hidden;
  }

  .month .month-title {
    font-size: 85%;
    font-weight: 700;
    padding: 12px;
    text-align: center;
    text-transform: uppercase;
    color: #ff4500;
    border-bottom: 2px solid #ff00ff;
    background: #f9f9f9;
  }

  .month .month-week {
    display: flex;
  }

  .month .month-blank-day-container {
    height: 30px;
    width: 30px;
  }

  .month .month-day-container {
    color: #666;
    font-size: 75%;
    height: 30px;
    line-height: 30px;
    position: relative;
    text-align: center;
    vertical-align: middle;
    width: 30px;
    transition: all 0.2s;
  }

  .month .month-day-container.active {
    background-color: #00ffff;
    color: #000;
    font-weight: bold;
    border-radius: 3px;
  }

  .month .month-day-container.active a {
    color: #000;
    text-decoration: none;
    display: block;
    width: 100%;
    height: 100%;
  }

  .month .month-day-container.active:hover,
  .month .month-day-container.active a:hover {
    background-color: #ff00ff;
    color: #fff;
  }

  h2 {
    color: #ff4500;
    text-shadow: 1px 1px #000;
    margin-top: 40px;
    margin-bottom: 20px;
    border-bottom: 3px dashed #ff00ff;
    padding-bottom: 10px;
  }

  .navigation {
    display: flex;
    justify-content: space-between;
    margin: 30px 0;
  }

  #yearSelect {
    padding: 10px 15px;
    border: 2px solid #ff00ff;
    border-radius: 5px;
    background: #fff;
    color: #ff00ff;
    font-weight: bold;
    cursor: pointer;
    font-family: var(--ff-body);
    margin: 20px 0 30px 0;
    transition: all 0.2s;
  }

  #yearSelect:hover {
    background: #fff9e6;
  }

  #yearSelect:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(255, 0, 255, 0.3);
  }

  .calendar-controls {
    display: flex;
    align-items: center;
    gap: 30px;
    margin: 20px 0 30px 0;
  }

  .calendar-hint {
    flex: 1;
    padding: 12px 20px;
    background: rgba(0, 255, 255, 0.1);
    border: 2px dashed #00ffff;
    border-radius: 6px;
  }

  .calendar-hint p {
    margin: 0;
    color: #666;
    font-size: 0.95em;
    font-style: italic;
  }

  @media (max-width: 1200px) {
    .calendar-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .calendar-controls {
      flex-direction: column;
      gap: 15px;
      align-items: stretch;
    }

    .calendar-hint {
      flex: none;
    }
  }

  @media (max-width: 768px) {
    .calendar-grid {
      grid-template-columns: 1fr;
      gap: 20px;
    }
  }

  /* Dark mode overrides */
  [data-theme="dark"] .hero-quote {
    background: var(--clr-main-bg);
    border-left-color: var(--clr-border);
  }

  [data-theme="dark"] .quote-text {
    color: var(--clr-text);
  }

  [data-theme="dark"] .quote-author {
    color: var(--clr-link);
  }

  [data-theme="dark"] .view-toggle {
    background: var(--clr-main-bg);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .view-toggle-btn {
    background: var(--clr-main-bg);
    color: var(--clr-link);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .view-toggle-btn:hover {
    background: var(--clr-nav-bg);
  }

  [data-theme="dark"] .view-toggle-btn.active {
    background: var(--clr-border);
    color: var(--clr-main-bg);
  }

  [data-theme="dark"] .stat-card {
    background: var(--clr-main-bg);
    border-color: var(--clr-border);
    box-shadow: 4px 4px 0 var(--clr-border);
  }

  [data-theme="dark"] .stat-label {
    color: var(--clr-text);
  }

  [data-theme="dark"] .toggle-btn {
    background: var(--clr-main-bg);
    border-color: var(--clr-border);
    color: var(--clr-link);
  }

  [data-theme="dark"] .toggle-btn.active {
    background: var(--clr-border);
    color: var(--clr-main-bg);
  }

  [data-theme="dark"] .chart-container {
    background: var(--clr-main-bg);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .timeline-calendar {
    background: var(--clr-background);
  }

  [data-theme="dark"] .year-section {
    background: var(--clr-main-bg);
    border-left-color: var(--clr-border);
  }

  [data-theme="dark"] .year-header {
    border-bottom-color: var(--clr-border);
  }

  [data-theme="dark"] .year-total {
    color: var(--clr-link);
  }

  [data-theme="dark"] .mini-calendar {
    background: var(--clr-main-bg);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .mini-day {
    background-color: #2a2a3e;
    border-color: #3a3a4e;
  }

  [data-theme="dark"] .timeline-legend {
    background: var(--clr-main-bg);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .timeline-stat-item {
    background: rgba(0, 212, 255, 0.1);
    border-left-color: var(--clr-border);
  }

  [data-theme="dark"] .timeline-stat-item .stat-label {
    color: var(--clr-text);
  }

  [data-theme="dark"] .activity-table,
  [data-theme="dark"] .repeated-table {
    background: var(--clr-main-bg);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .activity-table th,
  [data-theme="dark"] .repeated-table th {
    background: var(--clr-nav-bg);
    border-bottom-color: var(--clr-border);
  }

  [data-theme="dark"] .activity-table td,
  [data-theme="dark"] .repeated-table td {
    border-bottom-color: #3a3a4e;
  }

  [data-theme="dark"] .activity-table tbody tr:hover,
  [data-theme="dark"] .repeated-table tbody tr:hover {
    background: var(--clr-nav-bg);
  }

  [data-theme="dark"] .repeated-table .count-column {
    background: var(--clr-nav-bg);
  }

  [data-theme="dark"] .repeated-table .definition-column {
    color: var(--clr-text);
  }

  [data-theme="dark"] .alphabet-chart {
    background: var(--clr-main-bg);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .letter-count {
    color: var(--clr-text);
  }

  [data-theme="dark"] .all-sources-container,
  [data-theme="dark"] .source-words-section,
  [data-theme="dark"] .random-word-section {
    background: var(--clr-main-bg);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .sources-controls {
    border-bottom-color: var(--clr-border);
  }

  [data-theme="dark"] .control-group label {
    color: var(--clr-link);
  }

  [data-theme="dark"] .source-search,
  [data-theme="dark"] .source-sort,
  [data-theme="dark"] .source-filter {
    background: var(--clr-main-bg);
    color: var(--clr-text);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .control-info {
    color: var(--clr-text);
  }

  [data-theme="dark"] #sourceCount {
    color: var(--clr-link);
  }

  [data-theme="dark"] .source-item {
    background: var(--clr-main-bg);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .source-item:hover {
    background: var(--clr-nav-bg);
    border-color: var(--clr-link);
  }

  [data-theme="dark"] .source-card {
    background: var(--clr-main-bg);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .source-card:hover {
    box-shadow: 4px 4px 0 var(--clr-border);
  }

  [data-theme="dark"] .source-card.active {
    background: var(--clr-border);
    color: var(--clr-main-bg);
  }

  [data-theme="dark"] .source-card.active .source-name {
    color: var(--clr-main-bg);
  }

  [data-theme="dark"] .source-card.active .source-count {
    color: var(--clr-text);
  }

  [data-theme="dark"] .source-count {
    color: var(--clr-text);
  }

  [data-theme="dark"] .source-words-header {
    border-bottom-color: var(--clr-border);
  }

  [data-theme="dark"] .close-btn {
    background: var(--clr-border);
  }

  [data-theme="dark"] .close-btn:hover {
    background: var(--clr-heading);
  }

  [data-theme="dark"] .word-item {
    background: var(--clr-main-bg);
    border-left-color: var(--clr-heading);
  }

  [data-theme="dark"] .word-item-definition {
    color: var(--clr-text);
  }

  [data-theme="dark"] .word-item-date {
    color: var(--clr-text);
    opacity: 0.7;
  }

  [data-theme="dark"] .milestone-list {
    background: var(--clr-main-bg);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .milestone-item {
    background: var(--clr-nav-bg);
  }

  [data-theme="dark"] .word-spotlight {
    background: linear-gradient(135deg, var(--clr-nav-bg), var(--clr-border));
  }

  [data-theme="dark"] .spotlight-source,
  [data-theme="dark"] .spotlight-date {
    color: var(--clr-text);
    opacity: 0.8;
  }

  [data-theme="dark"] .refresh-note {
    color: var(--clr-text);
    opacity: 0.7;
  }

  [data-theme="dark"] .month {
    background: var(--clr-main-bg);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .month .month-title {
    background: var(--clr-nav-bg);
  }

  [data-theme="dark"] .month .month-day-container {
    color: var(--clr-text);
  }

  [data-theme="dark"] .month .month-day-container.active {
    background-color: var(--clr-border);
    color: var(--clr-main-bg);
  }

  [data-theme="dark"] .month .month-day-container.active a {
    color: var(--clr-main-bg);
  }

  [data-theme="dark"] .month .month-day-container.active:hover,
  [data-theme="dark"] .month .month-day-container.active a:hover {
    background-color: var(--clr-link);
    color: var(--clr-main-bg);
  }

  [data-theme="dark"] h2 {
    border-bottom-color: var(--clr-border-dashed);
  }

  [data-theme="dark"] #yearSelect {
    background: var(--clr-main-bg);
    color: var(--clr-link);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] #yearSelect:hover {
    background: var(--clr-nav-bg);
  }

  [data-theme="dark"] .calendar-hint {
    background: rgba(0, 212, 255, 0.1);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .calendar-hint p {
    color: var(--clr-text);
  }

  /* Search component dark mode */
  [data-theme="dark"] .search-filters {
    background: var(--clr-nav-bg);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .filter-group label {
    color: var(--clr-text);
  }

  [data-theme="dark"] .filter-group input,
  [data-theme="dark"] .filter-group select {
    background: var(--clr-main-bg);
    color: var(--clr-text);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .filter-group input:focus,
  [data-theme="dark"] .filter-group select:focus {
    background: var(--clr-main-bg);
    box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.3);
  }

  [data-theme="dark"] .reset-btn {
    background: var(--clr-border);
    color: var(--clr-main-bg);
  }

  [data-theme="dark"] .reset-btn:hover {
    background: var(--clr-link);
    box-shadow: 3px 3px 0 var(--clr-border);
  }

  [data-theme="dark"] .results-info {
    color: var(--clr-text);
  }

  [data-theme="dark"] .word-item {
    background: var(--clr-main-bg);
    border-color: var(--clr-border);
    box-shadow: 2px 2px 0 var(--clr-border);
  }

  [data-theme="dark"] .word-item-source,
  [data-theme="dark"] .word-item-language {
    background: var(--clr-nav-bg);
    color: var(--clr-text);
  }

  [data-theme="dark"] .word-item-language.spanish {
    background: rgba(255, 107, 53, 0.2);
    color: var(--clr-heading);
  }

  [data-theme="dark"] .word-item-language.english {
    background: rgba(0, 212, 255, 0.2);
    color: var(--clr-link);
  }

  [data-theme="dark"] .word-item-definition {
    color: var(--clr-text);
  }

  [data-theme="dark"] .word-item-date {
    color: var(--clr-text);
    opacity: 0.7;
  }

  [data-theme="dark"] .no-results {
    color: var(--clr-text);
    opacity: 0.7;
  }

  [data-theme="dark"] .pagination {
    background: var(--clr-nav-bg);
    border-color: var(--clr-border);
  }

  [data-theme="dark"] .pagination-btn {
    background: var(--clr-border);
    color: var(--clr-main-bg);
  }

  [data-theme="dark"] .pagination-btn:hover:not(:disabled) {
    background: var(--clr-link);
  }

  [data-theme="dark"] .pagination-btn:disabled {
    background: #3a3a4e;
    opacity: 0.5;
  }

  [data-theme="dark"] #pageInfo {
    color: var(--clr-text);
  }
</style>

<div class="hero-quote">
  <blockquote
    cite="https://www.goodreads.com/quotes/9894290-our-language-one-of-our-most-precious-natural-resources-in"
  >
    <p class="quote-text">
      "Our language, one of our most precious natural resources, deserves at
      least as much protection as our woodlands, streams and whooping cranes."
    </p>
    <footer class="quote-author">
      ‚Äî James Lipton, An Exaltation of Larks: The Ultimate Edition
    </footer>
  </blockquote>
</div>

<div class="intro-text">
  <p>
    Every day, words catch my attention‚Äîstriking phrases, unfamiliar terms,
    unexpected uses of language. I document them here to preserve and reflect on
    the richness of language itself. Here you'll find their definitions,
    sources, and the occasional note about why each one resonated with me.
  </p>
  <p>
    I try to write each word on paper. What started as a straightforward effort to
    expand my vocabulary evolved into a sort of ritual. The deliberate act of recording words on paper
    transformed vocabulary building into a meditative practice, and it gave me
    the perfect excuse to use my <a href="/pens">pens</a>.
  </p>
</div>

<div class="view-toggle-container">
  <div class="view-toggle">
    <button class="view-toggle-btn active" data-view="words">
      Latest Words
    </button>
    <button class="view-toggle-btn" data-view="search">Search</button>
    <button class="view-toggle-btn" data-view="overview">Overview</button>
  </div>
</div>

<div id="wordsView" class="content-view">
  {% set latestCuration =
  collections.word_curation[collections.word_curation.length - 1] %} {% set
  words = latestCuration.data.words %} {% set date = latestCuration.data.date %}
  {% include 'curation.njk' %} {% set previousCuration =
  collections.word_curation | getPreviousCuration(latestCuration.date) %} {% set
  nextCuration = collections.word_curation |
  getNextCuration(latestCuration.date) %}

  <div class="navigation">
    {% if previousCuration %}
    <a href="{{ previousCuration.url }}">Previous Curation</a>
    {% endif %} {% if nextCuration %}
    <a href="{{ nextCuration.url }}">Next Curation</a>
    {% endif %}
  </div>

  {% calendar { year: 2025, collection: collections.word_curation, baseUrl: baseUrl, locale: locale or 'en' } %}
</div>

<div id="overviewView" class="content-view" style="display: none">
  {% set stats = collections.word_curation | getWordStats %}

  <h2>Collection Overview</h2>

  <!-- Stats Section -->
  <div class="overview-section expanded">
    <div class="overview-section-header">
      <h3>üìä Statistics</h3>
      <span class="overview-toggle-icon">‚ñº</span>
    </div>
    <div class="overview-section-content">
      <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-number">{{ stats.totalWords }}</div>
      <div class="stat-label">Total Words Collected</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-number">{{ stats.distinctWords }}</div>
      <div class="stat-label">Distinct Words</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-number">{{ stats.spanishWordCount }}</div>
      <div class="stat-label">Spanish Words</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-number">{{ stats.totalCurations }}</div>
      <div class="stat-label">Curation Sessions</div>
    </div>    <div class="stat-card">
      <div class="stat-number">
        {{ stats.averageWordsPerCuration | round(1) }}
      </div>
      <div class="stat-label">Avg Words Per Session</div>
    </div>

    <div class="stat-card">
      <div class="stat-number">{{ stats.daysCollecting }}</div>
      <div class="stat-label">Days Collecting</div>
    </div>
  </div>

  <div class="timeline-stats" id="calendarStats" style="margin-top: 30px;">
    <div class="timeline-stat-item">
      <span class="stat-label">Most Active Month</span>
      <span class="stat-value">
        {% set topMonth = stats.topMonths[0] %}
        {{ topMonth.monthName }} ({{ topMonth.wordCount }})
      </span>
    </div>
    <div class="timeline-stat-item">
      <span class="stat-label">Peak Year</span>
      <span class="stat-value">
        {% set peakYear = stats.yearlyBreakdown[0] %} {% for year in
        stats.yearlyBreakdown %} {% if year.count > peakYear.count %} {% set
        peakYear = year %} {% endif %} {% endfor %}
        {{ peakYear.year }} ({{ peakYear.count }})
      </span>
    </div>
    <div class="timeline-stat-item">
      <span class="stat-label">Average per Year</span>
      <span
        class="stat-value"
        >{{ (stats.totalWords / stats.yearlyBreakdown | length) | round(0) }}</span
      >
    </div>
    <div class="timeline-stat-item">
      <span class="stat-label">Longest Streak</span>
      <span class="stat-value" id="longestStreakValue">--</span>
    </div>
    <div class="timeline-stat-item">
      <span class="stat-label">Current Streak</span>
      <span class="stat-value" id="currentStreakValue">--</span>
    </div>
  </div>

  <h2 style="margin-top: 40px;">Most Active Months</h2>
  <div class="monthly-activity">
    <table class="activity-table">
      <thead>
        <tr>
          <th>Month</th>
          <th>Words Collected</th>
          <th>Sessions</th>
        </tr>
      </thead>
      <tbody>
        {% for month in stats.topMonths %}
        <tr>
          <td>{{ month.monthName }}</td>
          <td>{{ month.wordCount }}</td>
          <td>{{ month.sessionCount }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <h2>Most Repeated Words</h2>
  <div class="repeated-words">
    {% if stats.repeatedWords.length > 0 %}
    <table class="repeated-table">
      <thead>
        <tr>
          <th>Word</th>
          <th>Times Collected</th>
          <th>Definition</th>
        </tr>
      </thead>
      <tbody>
        {% for item in stats.repeatedWords %}
        <tr>
          <td class="word-column">{{ item.word }}</td>
          <td class="count-column">{{ item.count }}</td>
          <td class="definition-column">{{ item.definition or 'N/A' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p>No repeated words yet!</p>
    {% endif %}
  </div>

  <h2>Words by First Letter</h2>
  <div class="alphabet-chart">
    {% for letter in stats.letterDistribution %}
    <div class="letter-bar">
      <div class="letter-label">{{ letter.letter }}</div>
      <div class="letter-bar-wrapper">
        <div
          class="letter-bar-fill"
          data-height="{{ (letter.count / stats.maxLetterCount) * 100 }}"
        >
          <span class="letter-count">{{ letter.count }}</span>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <h2>Top Sources</h2>
  <div class="sources-grid" id="sourcesGrid">
    {% for source in stats.topSources %}
    <div class="source-card" data-source="{{ source.name }}">
      <div class="source-name">{{ source.name }}</div>
      <div class="source-count">{{ source.count }} words</div>
    </div>
    {% endfor %}
  </div>

  <div
    id="sourceWordsSection"
    class="source-words-section"
    style="display: none"
  >
    <div class="source-words-header">
      <h3>Words from <span id="selectedSourceName"></span></h3>
      <button id="closeSourceView" class="close-btn">‚úï</button>
    </div>
    <div id="sourceWordsList" class="source-words-list"></div>
  </div>

  <script type="application/json" id="wordsBySourceDataScript">
    {{ stats.wordsBySource | dump | safe }}
  </script>
    </div>
  </div>

  <!-- Timeline Section -->
  <div class="overview-section expanded">
    <div class="overview-section-header">
      <h3>üìÖ Collection Timeline</h3>
      <span class="overview-toggle-icon">‚ñº</span>
    </div>
    <div class="overview-section-content">

  <div class="timeline-chart">
    <div class="chart-container timeline-calendar" id="calendarView">
      <div class="calendar-grid">
        {% set yearCount = stats.yearlyBreakdown | length %} {% for year in
        stats.yearlyBreakdown | reverse %}
        <div class="year-section expanded">
          <div class="year-header">
            <div>
              <h3>{{ year.year }}</h3>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
              <span class="year-total">{{ year.count }} words</span>
              <span class="year-toggle-icon">‚ñº</span>
            </div>
          </div>
          <!-- Placeholder for month mini-calendars -->
          <div class="months-grid">
            {% for month in range(1, 13) %}
            <div class="mini-calendar">
              <div class="mini-month-label">
                {% if month == 1 %}Jan {% elif month == 2 %}Feb {% elif month ==
                3 %}Mar {% elif month == 4 %}Apr {% elif month == 5 %}May {%
                elif month == 6 %}Jun {% elif month == 7 %}Jul {% elif month ==
                8 %}Aug {% elif month == 9 %}Sep {% elif month == 10 %}Oct {%
                elif month == 11 %}Nov {% else %}Dec {% endif %}
              </div>
              <div class="mini-days">
                {% set daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31,
                30, 31] %} {% set isLeapYear = (year.year % 4 == 0 and year.year
                % 100 != 0) or (year.year % 400 == 0) %} {% set dayCount =
                daysInMonth[month - 1] %} {% if month == 2 and isLeapYear %}{%
                set dayCount = 29 %}{% endif %} {% for day in range(1, dayCount
                + 1) %}
                <div
                  class="mini-day"
                  data-year="{{ year.year }}"
                  data-month="{{ month }}"
                  data-day="{{ day }}"
                ></div>
                {% endfor %}
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endfor %}
      </div>

      <div class="timeline-legend">
        <div class="legend-title">Collection Intensity</div>
        <div class="legend-scale">
          <div class="legend-item">
            <div class="legend-box" style="background-color: #e0e0e0"></div>
            <span>No words</span>
          </div>
          <div class="legend-item">
            <div class="legend-box" style="background-color: #00ffff"></div>
            <span>Light</span>
          </div>
          <div class="legend-item">
            <div class="legend-box" style="background-color: #ff00ff"></div>
            <span>Medium</span>
          </div>
          <div class="legend-item">
            <div class="legend-box" style="background-color: #ff0080"></div>
            <span>Heavy</span>
          </div>
        </div>
      </div>
    </div>


  </div>
    </div>
  </div>

  <!-- Milestones Section -->
  <div class="overview-section expanded">
    <div class="overview-section-header">
      <h3>üéØ Collection Milestones</h3>
      <span class="overview-toggle-icon">‚ñº</span>
    </div>
    <div class="overview-section-content">
  <div class="milestones">
    <ul class="milestone-list">
      <li class="milestone-item">
        <span class="milestone-icon">üéØ</span>
        <div class="milestone-text">
          <strong>First Word:</strong> {{ stats.firstWord.word }} on
          {{ stats.firstWord.date | formatDate }}
        </div>
      </li>
      <li class="milestone-item">
        <span class="milestone-icon">üèÜ</span>
        <div class="milestone-text">
          <strong>Latest Word:</strong> {{ stats.latestWord.word }} on
          {{ stats.latestWord.date | formatDate }}
        </div>
      </li>
      <li class="milestone-item">
        <span class="milestone-icon">üî•</span>
        <div class="milestone-text">
          <strong>Current Streak:</strong> <span id="milestoneCurrentStreakValue">{{ stats.currentStreak }} days</span>
        </div>
      </li>
    </ul>
  </div>
    </div>
  </div>

  <!-- Random Word Section -->
  <div class="overview-section expanded">
    <div class="overview-section-header">
      <h3>üé≤ Random Word Discovery</h3>
      <span class="overview-toggle-icon">‚ñº</span>
    </div>
    <div class="overview-section-content">
  <div class="random-word-section">
    {% set randomWord = stats.randomWord %}
    <div class="word-spotlight">
      <h3 class="spotlight-word">{{ randomWord.word }}</h3>
      <p class="spotlight-definition">{{ randomWord.definition }}</p>
      {% if randomWord.source %}
      <p class="spotlight-source">Source: {{ randomWord.source }}</p>
      {% endif %}
      <p class="spotlight-date">
        Collected on {{ randomWord.date | formatDate }}
      </p>
    </div>
    <p class="refresh-note">
      <em>Refresh the page to discover a new word!</em>
    </p>
  </div>
    </div>
  </div>

</div>

<div id="searchView" class="content-view" style="display: none">
  <h2>Search Words</h2>
  
  <div class="search-container">
    <div class="search-filters">
      <div class="filter-group">
        <label for="wordSearch">Search by Word:</label>
        <input type="text" id="wordSearch" placeholder="Type a word..." />
      </div>

      <div class="filter-group">
        <label for="searchSourceFilter">Filter by Source:</label>
        <select id="searchSourceFilter">
          <option value="">All Sources</option>
          {% for source in stats.allSources %}
            <option value="{{ source.name }}">{{ source.name }} ({{ source.count }})</option>
          {% endfor %}
        </select>
      </div>

      <div class="filter-group">
        <label for="searchLanguageFilter">Filter by Language:</label>
        <select id="searchLanguageFilter">
          <option value="">All Languages</option>
          <option value="spanish">Spanish</option>
          <option value="english">English</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="searchSortBy">Sort by:</label>
        <select id="searchSortBy">
          <option value="relevance">Relevance</option>
          <option value="word-az">Word (A-Z)</option>
          <option value="word-za">Word (Z-A)</option>
          <option value="newest">Newest First</option>
          <option value="oldest">Oldest First</option>
        </select>
      </div>

      <button id="searchResetFilters" class="reset-btn">Reset Filters</button>
    </div>

    <div class="search-results">
      <div class="results-info">
        <p>Found <span id="resultCount">0</span> words</p>
      </div>
      <div id="searchResultsList" class="words-list"></div>
      
      <div id="paginationControls" class="pagination" style="display: none">
        <button id="prevPage" class="pagination-btn">‚Üê Previous</button>
        <span id="pageInfo">Page <span id="currentPage">1</span> of <span id="totalPages">1</span></span>
        <button id="nextPage" class="pagination-btn">Next ‚Üí</button>
      </div>
    </div>
  </div>
</div>

<script type="application/json" id="allWordsDataScript">
  [
  {%- for curation in collections.word_curation %}
    {%- set outerLoopLast = loop.last -%}
    {%- for word in curation.data.words -%}
      {
        "word": "{{ word.word }}",
        "definition": "{{ word.definition | replace('"', '\\"') }}",
        "source": "{{ word.source or 'Unknown' }}",
        "date": "{{ curation.data.date | formatDate }}"
      }{{ "," if not (loop.last and outerLoopLast) }}
    {%- endfor -%}
  {%- endfor %}
  ]
</script>

<style>
  .search-container {
    margin-top: 30px;
  }

  .search-filters {
    background: #fff9e6;
    border: 2px solid #ff00ff;
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 30px;
    display: grid;
    grid-template-columns: 1fr;
    gap: 10px;
  }

  @media (min-width: 600px) {
    .search-filters {
      padding: 20px;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
    }
  }

  .filter-group {
    display: flex;
    flex-direction: column;
  }

  .filter-group label {
    font-weight: bold;
    margin-bottom: 8px;
    color: #333;
  }

  .filter-group input,
  .filter-group select {
    padding: 10px;
    border: 2px solid #ff00ff;
    border-radius: 5px;
    font-family: var(--ff-body);
    font-size: 1em;
    width: 100%;
    box-sizing: border-box;
  }

  .filter-group input:focus,
  .filter-group select:focus {
    outline: none;
    background: #fff;
    box-shadow: 0 0 0 3px rgba(255, 0, 255, 0.2);
  }

  .reset-btn {
    align-self: flex-end;
    height: fit-content;
  }

  .reset-btn {
    padding: 10px 20px;
    background: #ff00ff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s;
  }

  .reset-btn:hover {
    background: #cc00cc;
    box-shadow: 3px 3px 0 #000;
  }

  .results-info {
    margin-bottom: 20px;
    font-size: 1.1em;
    color: #333;
  }

  .words-list {
    display: grid;
    gap: 15px;
  }

  .word-item {
    background: #fff;
    border: 2px solid #ff00ff;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 2px 2px 0 #000;
  }

  .word-item-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
  }

  .word-item-title {
    font-size: 1.3em;
    font-weight: bold;
    color: #ff4500;
  }

  .word-item-meta {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    font-size: 0.9em;
  }

  .word-item-source {
    background: #f0f0f0;
    padding: 4px 10px;
    border-radius: 4px;
    color: #555;
  }

  .word-item-language {
    background: #f0f0f0;
    padding: 4px 10px;
    border-radius: 4px;
    color: #555;
  }

  .word-item-language.spanish {
    background: #fff9e6;
    color: #ff00ff;
    font-weight: bold;
  }

  .word-item-language.english {
    background: #e6f3ff;
    color: #0066ff;
    font-weight: bold;
  }

  .word-item-definition {
    color: #333;
    font-size: 1em;
    line-height: 1.6;
    margin-top: 10px;
  }

  .word-item-date {
    color: #999;
    font-size: 0.85em;
    margin-top: 10px;
  }

  .no-results {
    text-align: center;
    padding: 40px;
    color: #999;
    font-size: 1.1em;
  }

  .pagination {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    margin-top: 30px;
    padding: 20px;
    background: #fff9e6;
    border: 2px solid #ff00ff;
    border-radius: 8px;
  }

  .pagination-btn {
    background: #ff00ff;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    font-size: 14px;
  }

  .pagination-btn:hover:not(:disabled) {
    background: #dd00dd;
  }

  .pagination-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    opacity: 0.6;
  }

  #pageInfo {
    font-weight: bold;
    color: #333;
    white-space: nowrap;
  }

  @media (max-width: 600px) {
    .months-grid {
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 8px;
    }

    .month-box {
      padding: 10px;
      font-size: 0.9em;
    }
  }

  @media (max-width: 768px) {
    .search-filters {
      grid-template-columns: 1fr;
    }

    .reset-btn {
      align-self: stretch;
    }

    .pagination {
      flex-wrap: wrap;
      gap: 10px;
    }

    .pagination-btn {
      padding: 6px 12px;
      font-size: 12px;
    }

    .reset-btn {
      width: 100%;
    }

    .word-item-header {
      flex-direction: column;
      gap: 10px;
    }
  }
</style>

  <!-- Embed daily breakdown data as plain JSON array -->
  <script type="application/json" id="dailyBreakdownDataScript">
    [
    {%- for date, count in stats.dailyBreakdown %}
      {"date": "{{ date }}", "count": {{ count }}}{{ "," if not loop.last }}
    {%- endfor %}
    ]
  </script>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Handle collapsible year sections on mobile
    const yearSections = document.querySelectorAll(".year-section");
    const isMobile = window.innerWidth <= 600;

    yearSections.forEach((section) => {
      const header = section.querySelector(".year-header");
      if (header) {
        header.addEventListener("click", function() {
          // Only collapse on mobile
          if (window.innerWidth <= 600) {
            section.classList.toggle("collapsed");
            section.classList.toggle("expanded");
          }
        });
      }
    });

    // Initialize mobile state
    if (isMobile) {
      yearSections.forEach((section, index) => {
        // Keep first year expanded, collapse others on mobile
        if (index > 0) {
          section.classList.remove("expanded");
          section.classList.add("collapsed");
        }
      });
    }

    // Handle collapsible overview sections
    const overviewSections = document.querySelectorAll(".overview-section");
    overviewSections.forEach((section) => {
      const header = section.querySelector(".overview-section-header");
      if (header) {
        header.addEventListener("click", function() {
          section.classList.toggle("collapsed");
          section.classList.toggle("expanded");
        });
      }
    });

    const toggleBtns = document.querySelectorAll(".view-toggle-btn");
    const wordsView = document.getElementById("wordsView");
    const searchView = document.getElementById("searchView");
    const overviewView = document.getElementById("overviewView");

    // Load all words data for search
    let allWords = [];
    try {
      const dataEl = document.getElementById("allWordsDataScript");
      if (dataEl && dataEl.textContent.trim()) {
        const rawText = dataEl.textContent.trim();
        allWords = JSON.parse(rawText);
      }
    } catch (e) {
      console.error("Error parsing words data:", e.message);
    }

    // Detect language of definition
    function detectLanguage(definition) {
      if (!definition) return 'unknown';
      
      const englishWords = ['the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by', 
        'is', 'are', 'was', 'were', 'be', 'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'could', 'should'];
      
      const spanishWords = ['el', 'la', 'los', 'las', 'un', 'una', 'de', 'que', 'y', 'o', 'pero', 'en', 'a',
        'es', 'son', 'era', 'eran', 'fue', 'fueron', 'sea', 'ser', 'estar', 'tener', 'hacer', 'por', 'para', 'con', 'sin'];
      
      const defLower = definition.toLowerCase();
      let englishCount = 0;
      let spanishCount = 0;
      
      englishWords.forEach(w => { if (defLower.includes(' ' + w + ' ') || defLower.startsWith(w + ' ')) englishCount++; });
      spanishWords.forEach(w => { if (defLower.includes(' ' + w + ' ') || defLower.startsWith(w + ' ')) spanishCount++; });
      
      if (spanishCount > englishCount && spanishCount > 0) return 'spanish';
      if (englishCount > spanishCount && englishCount > 0) return 'english';
      return 'unknown';
    }

    // Pagination state
    let currentPage = 1;
    const resultsPerPage = 10;
    let filteredResults = [];

    // Filter and display search results
    function updateSearchResults() {
      const wordSearchEl = document.getElementById("wordSearch");
      const sourceFilterEl = document.getElementById("searchSourceFilter");
      const languageFilterEl = document.getElementById("searchLanguageFilter");
      const sortByEl = document.getElementById("searchSortBy");
      
      const wordSearch = wordSearchEl ? wordSearchEl.value.toLowerCase() : '';
      const sourceFilter = sourceFilterEl ? sourceFilterEl.value : '';
      const languageFilter = languageFilterEl ? languageFilterEl.value : '';
      const sortBy = sortByEl ? sortByEl.value : 'relevance';

      // Filter
      filteredResults = allWords.filter(word => {
        const wordMatch = !wordSearch || word.word.toLowerCase().includes(wordSearch) || word.definition.toLowerCase().includes(wordSearch);
        const sourceMatch = !sourceFilter || word.source === sourceFilter;
        let languageMatch = true;
        
        if (languageFilter) {
          const detectedLang = detectLanguage(word.definition);
          languageMatch = detectedLang === languageFilter;
        }
        
        return wordMatch && sourceMatch && languageMatch;
      });

      // Sort
      if (sortBy === 'word-az') {
        filteredResults.sort((a, b) => a.word.localeCompare(b.word));
      } else if (sortBy === 'word-za') {
        filteredResults.sort((a, b) => b.word.localeCompare(a.word));
      } else if (sortBy === 'newest') {
        filteredResults.sort((a, b) => new Date(b.date) - new Date(a.date));
      } else if (sortBy === 'oldest') {
        filteredResults.sort((a, b) => new Date(a.date) - new Date(b.date));
      } else if (sortBy === 'relevance' && wordSearch) {
        // Sort by how well word matches (exact match first, then contains at start, then contains anywhere)
        filteredResults.sort((a, b) => {
          const aExact = a.word.toLowerCase() === wordSearch ? 0 : a.word.toLowerCase().startsWith(wordSearch) ? 1 : 2;
          const bExact = b.word.toLowerCase() === wordSearch ? 0 : b.word.toLowerCase().startsWith(wordSearch) ? 1 : 2;
          return aExact - bExact || a.word.localeCompare(b.word);
        });
      }

      // Reset to first page and display
      currentPage = 1;
      displaySearchResults();
    }

    // Alias for performSearch
    const performSearch = updateSearchResults;

    // Display paginated results
    function displaySearchResults() {
      const resultsList = document.getElementById("searchResultsList");
      const resultCount = document.getElementById("resultCount");
      const paginationControls = document.getElementById("paginationControls");
      
      resultCount.textContent = filteredResults.length;

      if (filteredResults.length === 0) {
        resultsList.innerHTML = '<div class="no-results">No words found matching your filters.</div>';
        paginationControls.style.display = 'none';
        return;
      }

      // Calculate pagination
      const totalPages = Math.ceil(filteredResults.length / resultsPerPage);
      const start = (currentPage - 1) * resultsPerPage;
      const end = start + resultsPerPage;
      const pageResults = filteredResults.slice(start, end);

      // Display results
      resultsList.innerHTML = pageResults.map(word => {
        const lang = detectLanguage(word.definition);
        const langLabel = lang.charAt(0).toUpperCase() + lang.slice(1);
        return `
          <div class="word-item">
            <div class="word-item-header">
              <div class="word-item-title">${word.word}</div>
              <div class="word-item-meta">
                <span class="word-item-source">${word.source}</span>
                <span class="word-item-language ${lang}">${langLabel}</span>
              </div>
            </div>
            <div class="word-item-definition">${word.definition}</div>
            <div class="word-item-date">Found on ${word.date}</div>
          </div>
        `;
      }).join('');

      // Show/hide pagination controls
      if (totalPages > 1) {
        paginationControls.style.display = 'flex';
        document.getElementById("currentPage").textContent = currentPage;
        document.getElementById("totalPages").textContent = totalPages;
        document.getElementById("prevPage").disabled = currentPage === 1;
        document.getElementById("nextPage").disabled = currentPage === totalPages;
      } else {
        paginationControls.style.display = 'none';
      }
    }

    // Set up search view event listeners
    const wordSearchInput = document.getElementById("wordSearch");
    const sourceFilter = document.getElementById("searchSourceFilter");
    const languageFilter = document.getElementById("searchLanguageFilter");
    const sortBySelect = document.getElementById("searchSortBy");
    const resetBtn = document.getElementById("searchResetFilters");
    const prevPageBtn = document.getElementById("prevPage");
    const nextPageBtn = document.getElementById("nextPage");

    if (wordSearchInput) {
      wordSearchInput.addEventListener("input", updateSearchResults);
    }
    if (sourceFilter) sourceFilter.addEventListener("change", updateSearchResults);
    if (languageFilter) languageFilter.addEventListener("change", updateSearchResults);
    if (sortBySelect) sortBySelect.addEventListener("change", updateSearchResults);
    if (resetBtn) {
      resetBtn.addEventListener("click", () => {
        if (wordSearchInput) wordSearchInput.value = "";
        if (sourceFilter) sourceFilter.value = "";
        if (languageFilter) languageFilter.value = "";
        if (sortBySelect) sortBySelect.value = "relevance";
        updateSearchResults();
      });
    }
    if (prevPageBtn) {
      prevPageBtn.addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          displaySearchResults();
          document.getElementById("searchResultsList").scrollIntoView({ behavior: 'smooth' });
        }
      });
    }
    if (nextPageBtn) {
      nextPageBtn.addEventListener("click", () => {
        const totalPages = Math.ceil(filteredResults.length / resultsPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          displaySearchResults();
          document.getElementById("searchResultsList").scrollIntoView({ behavior: 'smooth' });
        }
      });
    }

    // View toggle handler
    toggleBtns.forEach((btn) => {
      btn.addEventListener("click", function () {
        const view = this.getAttribute("data-view");

        // Update button states
        toggleBtns.forEach((b) => b.classList.remove("active"));
        this.classList.add("active");

        // Toggle views
        wordsView.style.display = "none";
        searchView.style.display = "none";
        overviewView.style.display = "none";

        if (view === "words") {
          wordsView.style.display = "";
        } else if (view === "search") {
          searchView.style.display = "";
          // Initialize search results if not already done
          if (!window.searchInitialized) {
            if (allWords && allWords.length > 0) {
              updateSearchResults();
            }
            window.searchInitialized = true;
          } else {
            // Already initialized, just ensure search is displayed
            displaySearchResults();
          }
        } else {
          overviewView.style.display = "";

          // Initialize overview content on first view
          if (!window.overviewInitialized) {
            // Slight delay to ensure DOM is fully painted
            setTimeout(function () {
              initializeOverview();
              window.overviewInitialized = true;
            }, 50);
          }
        }
      });
    });

    // Handle URL parameters for automatic filtering
    const urlParams = new URLSearchParams(window.location.search);
    const sourceParam = urlParams.get('source');
    
    if (sourceParam) {
      // Switch to search view
      const searchBtn = document.querySelector('.view-toggle-btn[data-view="search"]');
      if (searchBtn) {
        // Update button states
        toggleBtns.forEach((b) => b.classList.remove("active"));
        searchBtn.classList.add("active");
        
        // Show search view
        wordsView.style.display = "none";
        searchView.style.display = "";
        overviewView.style.display = "none";
        
        // Set the source filter
        const sourceFilterEl = document.getElementById("searchSourceFilter");
        if (sourceFilterEl) {
          sourceFilterEl.value = sourceParam;
        }
        
        // Initialize and run search with filter
        if (allWords && allWords.length > 0) {
          updateSearchResults();
          window.searchInitialized = true;
          
          // Scroll to search results after results are populated
          setTimeout(() => {
            const searchResultsList = document.getElementById("searchResultsList");
            if (searchResultsList) {
              searchResultsList.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
          }, 100);
        }
      }
    }
  });

  function initializeOverview() {
    // Parse daily breakdown if needed
    try {
      const dataEl = document.getElementById("dailyBreakdownDataScript");
      if (dataEl && dataEl.textContent.trim()) {
        const jsonArray = JSON.parse(dataEl.textContent);
        window.dailyBreakdownData = {};
        jsonArray.forEach((item) => {
          window.dailyBreakdownData[item.date] = item.count;
        });
      }
    } catch (e) {
      // Data might already be initialized
    }

    // Parse words by source data from embedded JSON script tag
    try {
      const dataScript = document.getElementById("wordsBySourceDataScript");
      if (dataScript) {
        window.wordsBySourceData = JSON.parse(dataScript.textContent);
      }
    } catch (e) {
      console.error("Error parsing source data:", e);
    }

    // Update width for bar fills (year bars - if any)
    document
      .querySelectorAll("#overviewView .bar-fill[data-width]")
      .forEach(function (el) {
        el.style.width = el.getAttribute("data-width") + "%";
      });

    // Update height for letter bar fills
    document
      .querySelectorAll("#overviewView .letter-bar-fill[data-height]")
      .forEach(function (el) {
        el.style.height = el.getAttribute("data-height") + "%";
      });

    // Initialize timeline features
    populateMiniCalendars();
    populateStreakStats();
    initializeSourcesView();
  }

  function populateMiniCalendars() {
    let dailyBreakdown = window.dailyBreakdownData || {};

    const miniDays = document.querySelectorAll("#overviewView .mini-day");

    miniDays.forEach((dayEl) => {
      const year = dayEl.getAttribute("data-year");
      const month = String(dayEl.getAttribute("data-month")).padStart(2, "0");
      const day = String(dayEl.getAttribute("data-day")).padStart(2, "0");
      const key = `${year}-${month}-${day}`;
      const count = dailyBreakdown[key] || 0;

      if (count > 0) {
        let color = "#e0e0e0";
        if (count === 1) {
          color = "#00ffff";
        } else if (count >= 2 && count <= 3) {
          color = "#ff00ff";
        } else if (count >= 4) {
          color = "#ff0080";
        }
        dayEl.style.backgroundColor = color;
        dayEl.title = `${count} word${count !== 1 ? "s" : ""}`;
      } else {
        dayEl.style.backgroundColor = "#e0e0e0";
      }
    });
  }

  function getColor(count) {
    if (count === 0) return "#e0e0e0";
    if (count === 1) return "#00ffff";
    if (count >= 2 && count <= 3) return "#ff00ff";
    if (count >= 4) return "#ff0080";
  }

  function populateStreakStats() {
    let dailyBreakdown = window.dailyBreakdownData || {};

    const datesWithData = Object.keys(dailyBreakdown).sort();
    if (!datesWithData.length) return;

    const firstDate = new Date(datesWithData[0]);
    const lastDate = new Date(datesWithData[datesWithData.length - 1]);
    const allDates = [];

    for (
      let d = new Date(firstDate);
      d <= lastDate;
      d.setDate(d.getDate() + 1)
    ) {
      allDates.push(d.toISOString().split("T")[0]);
    }

    let longestStreak = 0;
    let currentStreak = 0;

    allDates.forEach((date) => {
      const count = dailyBreakdown[date] || 0;

      if (count > 0) {
        currentStreak++;
        longestStreak = Math.max(longestStreak, currentStreak);
      } else {
        currentStreak = 0;
      }
    });

    // Update the streak stat elements in the calendar view
    const longestStreakEl = document.getElementById("longestStreakValue");
    const currentStreakEl = document.getElementById("currentStreakValue");

    if (longestStreakEl) {
      longestStreakEl.textContent = `${longestStreak} days`;
    }
    if (currentStreakEl) {
      currentStreakEl.textContent = `${currentStreak} days`;
    }

    // Also update the milestone value to keep UI consistent with client computation
    const milestoneStreakEl = document.getElementById("milestoneCurrentStreakValue");
    if (milestoneStreakEl) {
      milestoneStreakEl.textContent = `${currentStreak} days`;
    }
  }

  function populateLinearView() {
    let dailyBreakdown = window.dailyBreakdownData || {};

    const datesWithData = Object.keys(dailyBreakdown).sort();
    if (!datesWithData.length) return;

    const firstDate = new Date(datesWithData[0]);
    const lastDate = new Date(datesWithData[datesWithData.length - 1]);
    const allDates = [];

    for (
      let d = new Date(firstDate);
      d <= lastDate;
      d.setDate(d.getDate() + 1)
    ) {
      allDates.push(d.toISOString().split("T")[0]);
    }

    const container = document.getElementById("linearDaysContainer");
    const statsContainer = document.getElementById("linearStats");

    if (!container || !allDates.length) return;

    container.innerHTML = "";

    const daysPerRow = 28;
    for (let i = 0; i < allDates.length; i += daysPerRow) {
      const weekRow = document.createElement("div");
      weekRow.className = "linear-week-row";

      const weekLabel = document.createElement("div");
      weekLabel.className = "linear-week-label";
      const startDate = allDates[i];
      const endDate =
        allDates[Math.min(i + daysPerRow - 1, allDates.length - 1)];
      weekLabel.textContent = `${startDate} to ${endDate}`;
      weekRow.appendChild(weekLabel);

      const daysContainer = document.createElement("div");
      daysContainer.className = "linear-week-days";

      for (let j = 0; j < daysPerRow && i + j < allDates.length; j++) {
        const date = allDates[i + j];
        const count = dailyBreakdown[date] || 0;

        const dayEl = document.createElement("div");
        dayEl.className = "linear-day";
        dayEl.style.backgroundColor = getColor(count);
        dayEl.title = `${date}: ${count} word${count !== 1 ? "s" : ""}`;
        daysContainer.appendChild(dayEl);
      }

      weekRow.appendChild(daysContainer);
      container.appendChild(weekRow);
    }

    let longestStreak = 0;
    let currentStreak = 0;
    let longestBreak = 0;
    let currentBreak = 0;

    allDates.forEach((date) => {
      const count = dailyBreakdown[date] || 0;

      if (count > 0) {
        currentStreak++;
        longestStreak = Math.max(longestStreak, currentStreak);
        if (currentBreak > 0) {
          longestBreak = Math.max(longestBreak, currentBreak);
          currentBreak = 0;
        }
      } else {
        if (currentStreak > 0) {
          currentStreak = 0;
        }
        currentBreak++;
      }
    });

    if (currentBreak > 0) {
      longestBreak = Math.max(longestBreak, currentBreak);
    }

    const activeDays = allDates.filter(
      (d) => dailyBreakdown[d] && dailyBreakdown[d] > 0
    ).length;

    statsContainer.innerHTML = `
      <div class="linear-stat-item">
        <span class="stat-label">Longest Streak</span>
        <span class="stat-value">${longestStreak} days</span>
      </div>
      <div class="linear-stat-item">
        <span class="stat-label">Longest Break</span>
        <span class="stat-value">${longestBreak} days</span>
      </div>
      <div class="linear-stat-item">
        <span class="stat-label">Days Active</span>
        <span class="stat-value">${activeDays}/${allDates.length}</span>
      </div>
    `;
  }

  function showSourceWords(sourceName) {
    if (
      !window.wordsBySourceData ||
      typeof window.wordsBySourceData !== "object"
    ) {
      console.error("wordsBySourceData is not available");
      return;
    }

    const words = window.wordsBySourceData[sourceName] || [];
    const section = document.getElementById("sourceWordsSection");
    const wordsList = document.getElementById("sourceWordsList");
    const selectedSourceName = document.getElementById("selectedSourceName");

    if (!section || !wordsList || !selectedSourceName) {
      console.error("Required DOM elements not found");
      return;
    }

    selectedSourceName.textContent = sourceName;

    // Clear and populate words list
    wordsList.innerHTML = "";

    if (words.length === 0) {
      wordsList.innerHTML = "<p>No words found for this source.</p>";
    } else {
      words.forEach((word) => {
        const wordEl = document.createElement("div");
        wordEl.className = "word-item";

        let dateStr = "Date unknown";
        try {
          dateStr = new Date(word.date).toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
          });
        } catch (e) {
          console.warn("Could not parse date:", word.date);
        }

        wordEl.innerHTML = `
          <div class="word-item-title">${escapeHtml(word.word)}</div>
          <div class="word-item-definition">${escapeHtml(
            word.definition || "No definition provided"
          )}</div>
          <div class="word-item-date">Collected on ${dateStr}</div>
        `;
        wordsList.appendChild(wordEl);
      });
    }

    // Update active state
    document.querySelectorAll(".source-card").forEach((el) => {
      el.classList.remove("active");
      if (el.getAttribute("data-source") === sourceName) {
        el.classList.add("active");
      }
    });

    // Show section
    section.style.display = "block";
    section.scrollIntoView({ behavior: "smooth", block: "nearest" });
  }

  function escapeHtml(text) {
    const div = document.createElement("div");
    div.textContent = text;
    return div.innerHTML;
  }

  // Initialize all sources view
  function initializeSourcesView() {
    const searchInput = document.getElementById("sourceSearch");
    const sortSelect = document.getElementById("sourceSort");
    const filterInput = document.getElementById("sourceFilter");
    const sourcesList = document.getElementById("allSourcesList");
    const sourceCountSpan = document.getElementById("sourceCount");

    if (!searchInput || !sortSelect || !filterInput || !sourcesList) return;

    // Store all original items
    const allItems = Array.from(sourcesList.querySelectorAll(".source-item"));

    function updateSourcesDisplay() {
      const searchTerm = searchInput.value.toLowerCase().trim();
      const minWords = parseInt(filterInput.value) || 1;
      const sortMethod = sortSelect.value;

      // Filter from original items
      let items = allItems.filter((item) => {
        const sourceName = item.getAttribute("data-source").toLowerCase();
        const wordCount = parseInt(item.getAttribute("data-count"));
        const matchesSearch =
          searchTerm === "" || sourceName.includes(searchTerm);
        const meetsMinWords = wordCount >= minWords;
        return matchesSearch && meetsMinWords;
      });

      // Sort
      items.sort((a, b) => {
        const countA = parseInt(a.getAttribute("data-count"));
        const countB = parseInt(b.getAttribute("data-count"));
        const nameA = a.getAttribute("data-source");
        const nameB = b.getAttribute("data-source");

        switch (sortMethod) {
          case "count-desc":
            return countB - countA;
          case "count-asc":
            return countA - countB;
          case "name-asc":
            return nameA.localeCompare(nameB);
          case "name-desc":
            return nameB.localeCompare(nameA);
          default:
            return 0;
        }
      });

      // Update display
      sourcesList.innerHTML = "";
      items.forEach((item) => {
        sourcesList.appendChild(item.cloneNode(true));
      });

      // Update count
      sourceCountSpan.textContent = `${items.length} source${
        items.length !== 1 ? "s" : ""
      }`;
    }

    // Add event listeners
    searchInput.addEventListener("keyup", updateSourcesDisplay);
    searchInput.addEventListener("input", updateSourcesDisplay);
    sortSelect.addEventListener("change", updateSourcesDisplay);
    filterInput.addEventListener("input", updateSourcesDisplay);
    filterInput.addEventListener("change", updateSourcesDisplay);

    // Make source items clickable
    sourcesList.addEventListener("click", function (e) {
      const sourceItem = e.target.closest(".source-item");
      if (sourceItem) {
        const sourceName = sourceItem.getAttribute("data-source");
        if (sourceName) {
          showSourceWords(sourceName);
        }
      }
    });

    // Handle source card clicks
    document.querySelectorAll(".source-card").forEach(function (card) {
      card.addEventListener("click", function () {
        const sourceName = this.getAttribute("data-source");
        if (sourceName) {
          showSourceWords(sourceName);
        }
      });
    });

    // Handle close button
    const closeBtn = document.getElementById("closeSourceView");
    if (closeBtn) {
      closeBtn.addEventListener("click", function () {
        const section = document.getElementById("sourceWordsSection");
        if (section) {
          section.style.display = "none";
        }
        document
          .querySelectorAll(".source-card")
          .forEach((el) => el.classList.remove("active"));
      });
    }
  }
</script>
